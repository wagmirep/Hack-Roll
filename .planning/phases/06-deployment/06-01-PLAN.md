---
phase: 06-deployment
plan: 01
type: execute
---

<objective>
Deploy LahStats backend and web frontend for hackathon demo with QR code access.

Purpose: Enable judges to scan QR code and access the full demo flow via web browser.
Output:
- Deployed FastAPI backend on Railway
- Deployed Expo web build on Vercel
- QR code pointing to live demo URL
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
~/.claude/get-shit-done/references/checkpoints.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@backend/config.py
@backend/main.py
@mobile/package.json
@mobile/app.json

**Architecture:**
- Backend: FastAPI with external ML API (Colab) integration
- Frontend: Expo React Native with web support via react-native-web
- Database: Supabase PostgreSQL (already cloud-hosted)
- Auth: Supabase Auth (already cloud-hosted)
- ML: Colab notebook exposed via ngrok (user manages separately)

**Key env vars needed for backend:**
- SUPABASE_URL
- SUPABASE_JWT_SECRET
- SUPABASE_SERVICE_ROLE_KEY
- REDIS_URL (Railway Redis addon)
- TRANSCRIPTION_API_URL (Colab ngrok URL)
- HUGGINGFACE_TOKEN
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create backend Dockerfile for Railway</name>
  <files>backend/Dockerfile, backend/.dockerignore</files>
  <action>
Create production Dockerfile for FastAPI backend:
- Use python:3.11-slim base image
- Install system dependencies (ffmpeg for audio processing)
- Copy requirements.txt and install Python deps
- Copy backend code
- Expose port 8000
- Use uvicorn with --host 0.0.0.0

Create .dockerignore to exclude: __pycache__, .env, .git, venv, *.pyc, .pytest_cache

Do NOT include ML model files - backend uses external API.
  </action>
  <verify>docker build -t lahstats-backend ./backend --dry-run passes syntax check, or just verify Dockerfile syntax is valid</verify>
  <done>Dockerfile and .dockerignore exist in backend/, ready for Railway deployment</done>
</task>

<task type="auto">
  <name>Task 2: Deploy backend to Railway</name>
  <files>railway.json (if created)</files>
  <action>
Use Railway CLI to deploy backend:

1. Install Railway CLI if needed: `npm install -g @railway/cli`
2. Login: `railway login` (opens browser)
3. Create new project: `railway init` in backend/ directory
4. Add Redis addon: `railway add --plugin redis`
5. Set environment variables via CLI:
   ```
   railway variables set SUPABASE_URL=<value>
   railway variables set SUPABASE_JWT_SECRET=<value>
   railway variables set SUPABASE_SERVICE_ROLE_KEY=<value>
   railway variables set HUGGINGFACE_TOKEN=<value>
   railway variables set TRANSCRIPTION_API_URL=<colab_ngrok_url>
   railway variables set DEBUG=false
   ```
6. Deploy: `railway up`
7. Get public URL: `railway domain`

Note: REDIS_URL will be auto-injected by Railway Redis addon.
  </action>
  <verify>`railway status` shows deployment running, `curl https://<railway-url>/health` returns 200</verify>
  <done>Backend deployed to Railway with public URL accessible</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Backend API deployed to Railway</what-built>
  <how-to-verify>
    1. Note the Railway URL from deployment output
    2. Visit: https://YOUR-RAILWAY-URL/docs (FastAPI Swagger UI)
    3. Confirm: Swagger page loads showing all endpoints
    4. Test: Try GET /health endpoint returns {"status": "ok"}
  </how-to-verify>
  <resume-signal>Provide the Railway URL and confirm API is accessible, or describe issues</resume-signal>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] backend/Dockerfile exists and is valid
- [ ] Backend deployed to Railway
- [ ] Railway URL is publicly accessible
- [ ] /health endpoint returns 200
</verification>

<success_criteria>
- Backend Dockerfile created
- Backend deployed to Railway with public URL
- API endpoints accessible from internet
- Ready for frontend deployment in Plan 02
</success_criteria>

<output>
After completion, create `.planning/phases/06-deployment/06-01-SUMMARY.md`:

# Phase 6 Plan 01: Backend Deployment Summary

**[Deployed FastAPI backend to Railway at URL]**

## Accomplishments
- Created production Dockerfile
- Deployed to Railway
- Configured environment variables
- API accessible at: [URL]

## Files Created/Modified
- `backend/Dockerfile` - Production container config
- `backend/.dockerignore` - Build exclusions

## Decisions Made
[Any decisions about deployment config]

## Issues Encountered
[Problems and resolutions, or "None"]

## Next Step
Ready for 06-02-PLAN.md (Frontend deployment)
</output>
